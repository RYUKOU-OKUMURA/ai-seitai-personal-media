import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as x}from"./index.DiEladB3.js";const O=m=>{const g=new Date(m);return Number.isNaN(g.getTime())?m.slice(0,10):g.toISOString().slice(0,10)},P=m=>m?new Date(`${m}T00:00:00.000Z`).toISOString():new Date().toISOString(),R=m=>{const g=new Date(m);if(Number.isNaN(g.getTime()))return m;const p=g.getUTCFullYear(),w=String(g.getUTCMonth()+1).padStart(2,"0"),S=String(g.getUTCDate()).padStart(2,"0");return`${p}.${w}.${S}`},F=({events:m,posts:g})=>{const[p,w]=x.useState("events"),[S,C]=x.useState(m),[U,k]=x.useState(g),[b,E]=x.useState(null),[d,u]=x.useState(!1),[T,a]=x.useState(null),[r,i]=x.useState(null),[j,y]=x.useState(null),[l,n]=x.useState(null),[v,N]=x.useState(null);x.useEffect(()=>{fetch("/api/auth/me").then(s=>s.json()).then(s=>{s.user&&E(s.user)}).catch(console.error)},[]);const f=async(s,t)=>{const o=await fetch(s,{...t,headers:{"Content-Type":"application/json",...t.headers??{}},credentials:"include"}),c=await o.json().catch(()=>({}));if(!o.ok){const h=c&&c.error||`Request failed (${o.status})`;throw new Error(h)}return c},L=()=>{window.location.href="/api/auth/login"},$=async()=>{u(!0);try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),E(null),a("ログアウトしました")}catch(s){a(s instanceof Error?s.message:String(s))}finally{u(!1)}},A=async s=>{if(s.preventDefault(),!!r){if(!b)return a("先にログインしてください");u(!0),a(null);try{if(!j){const{event:o}=await f("/api/admin/events",{method:"POST",body:JSON.stringify(r)});C(c=>[o,...c])}else{const{event:o}=await f(`/api/admin/events/${j}`,{method:"PUT",body:JSON.stringify(r)});C(c=>c.map(h=>h.slug===j?o:h))}i(null),y(null),a("保存しました。公開反映はVercelのビルド完了後になります。")}catch(t){a(t instanceof Error?t.message:String(t))}finally{u(!1)}}},q=async s=>{if(!b)return a("先にログインしてください");if(confirm("本当に削除しますか？")){u(!0),a(null);try{await f(`/api/admin/events/${s}`,{method:"DELETE"}),C(t=>t.filter(o=>o.slug!==s)),a("削除しました。公開反映はVercelのビルド完了後になります。")}catch(t){a(t instanceof Error?t.message:String(t))}finally{u(!1)}}},I=async s=>{if(s.preventDefault(),!!l){if(!b)return a("先にログインしてください");u(!0),a(null);try{const t={...l,publishedAt:P(O(l.publishedAt))};if(!v){const{post:c}=await f("/api/admin/blog",{method:"POST",body:JSON.stringify(t)});k(h=>[c,...h])}else{const{post:c}=await f(`/api/admin/blog/${v}`,{method:"PUT",body:JSON.stringify(t)});k(h=>h.map(D=>D.slug===v?c:D))}n(null),N(null),a("保存しました。公開反映はVercelのビルド完了後になります。")}catch(t){a(t instanceof Error?t.message:String(t))}finally{u(!1)}}},M=async s=>{if(!b)return a("先にログインしてください");if(confirm("本当に削除しますか？")){u(!0),a(null);try{await f(`/api/admin/blog/${s}`,{method:"DELETE"}),k(t=>t.filter(o=>o.slug!==s)),a("削除しました。公開反映はVercelのビルド完了後になります。")}catch(t){a(t instanceof Error?t.message:String(t))}finally{u(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsxs("div",{className:"bg-[#111921] text-white px-6 py-4 flex flex-col md:flex-row md:justify-between md:items-center gap-4 sticky top-0 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"admin_panel_settings"}),"管理画面 (CMS)"]}),e.jsx("a",{href:"/",className:"md:hidden text-sm bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded transition-colors",children:"サイトへ"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 items-stretch sm:items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-300",children:[b.picture&&e.jsx("img",{src:b.picture,alt:b.name,className:"w-6 h-6 rounded-full"}),e.jsx("span",{children:b.name})]}),e.jsx("button",{type:"button",onClick:$,className:"text-sm bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded transition-colors",disabled:d,children:"ログアウト"}),e.jsx("a",{href:"/",className:"hidden md:inline-flex text-sm bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded transition-colors",children:"サイトへ"})]}):e.jsx(e.Fragment,{children:e.jsxs("button",{type:"button",onClick:L,className:"text-sm bg-white text-[#111418] hover:bg-gray-100 px-4 py-2 rounded font-bold transition-colors disabled:opacity-60 flex items-center gap-2",disabled:d,children:[e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Googleでログイン"]})})})]}),e.jsxs("div",{className:"max-w-[1100px] mx-auto px-4 py-8",children:[T?e.jsx("div",{className:"mb-6 bg-white border border-gray-200 rounded p-4 text-sm text-gray-700",children:T}):null,e.jsxs("div",{className:"flex gap-2 mb-8 border-b border-gray-200",children:[e.jsx("button",{className:`px-6 py-3 font-bold rounded-t-lg transition-colors ${p==="events"?"bg-white text-primary border-t border-x border-gray-200":"text-gray-500 hover:bg-gray-100"}`,onClick:()=>{w("events"),i(null),y(null)},children:"イベント管理"}),e.jsx("button",{className:`px-6 py-3 font-bold rounded-t-lg transition-colors ${p==="blog"?"bg-white text-primary border-t border-x border-gray-200":"text-gray-500 hover:bg-gray-100"}`,onClick:()=>{w("blog"),n(null),N(null)},children:"コラム・ブログ管理"})]}),p==="events"&&e.jsx("div",{children:r?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:j?"イベント編集":"イベント新規作成"}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"slug (URL用・半角英数と-)"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2 disabled:bg-gray-50",value:r.slug,onChange:s=>i({...r,slug:s.target.value}),placeholder:"event-20240210",disabled:!!j}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"未入力なら自動生成されます"})]}),e.jsx("div",{className:"flex items-end gap-3",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-bold",children:[e.jsx("input",{type:"checkbox",checked:r.draft,onChange:s=>i({...r,draft:s.target.checked})}),"下書き"]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"タイトル"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:r.title,onChange:s=>i({...r,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"日時 (表示用)"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:r.dateLabel,onChange:s=>i({...r,dateLabel:s.target.value}),placeholder:"2024.02.10 (土)",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"タグ"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:r.tag,onChange:s=>i({...r,tag:s.target.value}),placeholder:"募集中 / 満席 / アーカイブ",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"画像URL"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:r.image,onChange:s=>i({...r,image:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"リンクURL"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:r.link,onChange:s=>i({...r,link:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{i(null),y(null)},className:"px-6 py-2 border border-gray-300 rounded hover:bg-gray-50",disabled:d,children:"キャンセル"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary text-white rounded font-bold hover:bg-blue-600 disabled:opacity-60",disabled:d,children:"保存する"})]})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"イベント一覧"}),e.jsxs("button",{onClick:()=>{y(null),i({slug:"",title:"",dateLabel:"",image:"",tag:"",link:"",draft:!1})},className:"bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-1 font-bold",disabled:d,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})," 新規追加"]})]}),e.jsx("div",{className:"space-y-4",children:S.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded p-4 flex gap-4 items-center",children:[e.jsx("img",{src:s.image,alt:"",className:"w-16 h-16 object-cover rounded bg-gray-100"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"text-xs text-gray-500",children:s.dateLabel}),e.jsx("div",{className:"font-bold text-[#111418]",children:s.title}),e.jsxs("div",{className:"text-xs text-primary font-bold flex items-center gap-2",children:[e.jsx("span",{children:s.tag}),s.draft?e.jsx("span",{className:"text-gray-500",children:"(下書き)"}):null]}),e.jsxs("div",{className:"text-[11px] text-gray-400 mt-1",children:["slug: ",s.slug]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{y(s.slug),i(s)},className:"p-2 text-gray-500 hover:text-primary",disabled:d,children:e.jsx("span",{className:"material-symbols-outlined",children:"edit"})}),e.jsx("button",{onClick:()=>q(s.slug),className:"p-2 text-gray-500 hover:text-red-500",disabled:d,children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})})]})]},s.slug))})]})}),p==="blog"&&e.jsx("div",{children:l?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:v?"記事編集":"記事新規作成"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"slug (URL用・半角英数と-)"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2 disabled:bg-gray-50",value:l.slug,onChange:s=>n({...l,slug:s.target.value}),placeholder:"my-first-post",disabled:!!v}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"未入力なら自動生成されます"})]}),e.jsxs("div",{className:"flex items-end gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"公開日"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded p-2",value:O(l.publishedAt),onChange:s=>n({...l,publishedAt:P(s.target.value)}),required:!0})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-bold",children:[e.jsx("input",{type:"checkbox",checked:l.draft,onChange:s=>n({...l,draft:s.target.checked})}),"下書き"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"タイトル"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:l.title,onChange:s=>n({...l,title:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"カテゴリー"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:l.category,onChange:s=>n({...l,category:s.target.value}),placeholder:"マインドセット / ノウハウ / お知らせ",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"アイキャッチ画像URL"}),e.jsx("input",{className:"w-full border border-gray-300 rounded p-2",value:l.image,onChange:s=>n({...l,image:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"抜粋 (一覧用リード文)"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded p-2",value:l.excerpt,onChange:s=>n({...l,excerpt:s.target.value}),rows:3,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"本文 (Markdown)"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded p-2 h-80 font-mono text-sm",value:l.content,onChange:s=>n({...l,content:s.target.value})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{n(null),N(null)},className:"px-6 py-2 border border-gray-300 rounded hover:bg-gray-50",disabled:d,children:"キャンセル"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary text-white rounded font-bold hover:bg-blue-600 disabled:opacity-60",disabled:d,children:"保存する"})]})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"記事一覧"}),e.jsxs("button",{onClick:()=>{N(null),n({slug:"",title:"",publishedAt:new Date().toISOString(),category:"",image:"",excerpt:"",content:"",draft:!1})},className:"bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-1 font-bold",disabled:d,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})," 記事を書く"]})]}),e.jsx("div",{className:"space-y-4",children:U.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded p-4 flex gap-4 items-center",children:[e.jsx("img",{src:s.image,alt:"",className:"w-24 h-16 object-cover rounded bg-gray-100"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[R(s.publishedAt)," / ",s.category," ",s.draft?" / 下書き":""]}),e.jsx("div",{className:"font-bold text-[#111418] line-clamp-1",children:s.title}),e.jsxs("div",{className:"text-[11px] text-gray-400 mt-1",children:["/blog/",s.slug]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{N(s.slug),n(s)},className:"p-2 text-gray-500 hover:text-primary",disabled:d,children:e.jsx("span",{className:"material-symbols-outlined",children:"edit"})}),e.jsx("button",{onClick:()=>M(s.slug),className:"p-2 text-gray-500 hover:text-red-500",disabled:d,children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})})]})]},s.slug))})]})})]})]})};export{F as default};
